{%extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block head_title%}{{title}}{%endblock%}

{%block content%}

<div class="row">
  
  <div class = "col-lg-12 md-padding">

    {% if messages %}
    <ul id='msg-box'>
      {% for message in messages %}
      <li class="alert alert-{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <div class='col-md-6 sm-padding'>
      <a href="{% url 'exp' %}"><button type="button" class="btn btn-success btn-sm">Nova execução</button></a>
      <a href="{% url 'example' %}"><button type="button" class="btn btn-default btn-sm">Exemplos</button></a>
      <form id="formRemove" method='POST' action='{% url 'removeList' title %}' enctype="multipart/form-data">
        {% csrf_token %}
        <input type="submit" id="btExcluir" class="btn btn-default btn-sm" value="Excluir">
      </form>
      </div>
      {% if request.user.is_superuser %}
      <div class='col-md-6 sm-padding text-right'>
        <form method="POST" action="" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="submit" name="showOpt" value="Todas" class="btn btn-link btn-sm" /> |
          <input type="submit" name="showOpt" value="Minhas" class="btn btn-link btn-sm" />
        </form>
    
      </div>
      {% endif %}

   
  {% if data != None %}  
    <table class="table table-striped table-bordered text-center">
        <thead>
          <tr>
            <th><input class="checkHeader" type="checkbox" value=""></th>
            <th>ID</th>
            
            {% if request.user.is_superuser %}
            {% if showOpt == 'Todas' %}
            <th>Usuário</th>
            {% endif %}
            <th>Visivel</th>
            {% endif %}
            
            <th data-align="center">Data Requisição</th>
            <th data-align="center">Status</th>
            <th>Algoritmo</th>
            <th>Tempo</th>
            <th>Arquivo Entrada</th>
            <th>Arquivo Saída</th>
          </tr>
        </thead>
        <tbody id="tableSel">
        {%for exp in data%}
        {% if request.user.is_superuser or request.user.is_superuser == False and exp.visible == 'yes' %}
        <tr>
          <td><input type="checkbox" value="{{exp.id}}"></td>
          <td>{{exp.id}}</td>
          

          {% if request.user.is_superuser %}
          {% if showOpt == 'Todas' %}
          <td>{{exp.request_by}}</td>
          {% endif %}
          <td>{{exp.visible}}</td>
          {% endif %}
          
          <td>{{exp.date_requisition}}</td>
          <td>
          {%if exp.status == 1%}
            Aguardando
          {%else%}
            {%if exp.status == 2%}
              Executando
            {%else%}
              {%if exp.status == 3%}
                Finalizado        
              {%endif%}
            {%endif%}
          {%endif%}
          </td>
          <td>{{exp.algorithm}}</td>
          <td>
          {%if exp.time == -1 %}
            -
          {%else%}
            {{exp.time|floatformat:-4}} s
          {%endif%}
          </td>
          <td>
          {% if exp.inputFile%}
          <a  href="{% url 'downloadInputFile'%}?id={{exp.id}}"><button type="button" class="btn btn-success">Download</button></a>
          {% else %}
          <button type="button" class="btn btn-warning disabled">Sem Entrada</button>
          {% endif %}
          </td>
          <td>
          {% if exp.outputFile%}
          <a  href="{% url 'downloadOutputFile'%}?id={{exp.id}}"><button type="button" class="btn btn-success">Download</button></a>
          {% else %}
          <button type="button" class="btn btn-warning disabled">Sem Resultado</button>
          {% endif %}
          </td>
        </tr>
        {% endif %}
        {% endfor %}
        </tbody>
    </table>

    <nav>
      <ul class="nav navbar-nav navbar-left">
        <ul class="pagination">
        {# CASO SEJA A PRIMEIRA PAGINA #}
          {% if data.has_previous %}
          <li>
            <a href="?page={{ data.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li> 
          {% else %}
          <li class="disabled">
            <span aria-hidden="true">&laquo;</span>
          </li>
          {% endif %}

          {% for page, value in pagesIndex.items %}
              {% if value > 0 %}
                {% if page == 2 %}
                <li class='active'><a href="#">{{value}}</a></li>
                {%else%}
                <li><a href="?page={{value}}">{{value}}</a></li>
                {% endif %}
              {%endif%}
          {% endfor %}

          
          {% if data.has_next %}
          <li>
            <a href="?page={{ data.next_page_number }}" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          {% else %}
          <li class="disabled">
            <span aria-hidden="true">&raquo;</span>
          {% endif %}
          </li>
          
        </ul>
      </ul>
    </nav>

  </div>
  
  {% else %}
    <div id="colForm" class="col-md-12 text-center">
      <hr>
      <p1>Você não possui experimentos</p1>
      <hr>
    </div>
    <div id="colForm" class="col-sm-3 col-md-3"></div>
  {% endif %}

</div>
{%endblock%}
